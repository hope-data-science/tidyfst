<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Example 5: Fst • tidyfst</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Example 5: Fst">
<meta property="og:description" content="tidyfst">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tidyfst</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.5.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/benchmark.html">Performance</a>
    </li>
    <li>
      <a href="../articles/chinese_tutorial.html">tidyfst包实例分析</a>
    </li>
    <li>
      <a href="../articles/english_tutorial.html">Use data.table the tidy way: An ultimate tutorial of tidyfst</a>
    </li>
    <li>
      <a href="../articles/example1_intro.html">Example 1: Basic usage</a>
    </li>
    <li>
      <a href="../articles/example2_join.html">Example 2: Join tables</a>
    </li>
    <li>
      <a href="../articles/example3_reshape.html">Example 3: Reshape</a>
    </li>
    <li>
      <a href="../articles/example4_nest.html">Example 4: Nest</a>
    </li>
    <li>
      <a href="../articles/example5_fst.html">Example 5: Fst</a>
    </li>
    <li>
      <a href="../articles/example6_dt.html">Example 6: Dt</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/hope-data-science/tidyfst/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="example5_fst_files/header-attrs-2.10/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Example 5: Fst</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/hope-data-science/tidyfst/blob/master/vignettes/example5_fst.Rmd"><code>vignettes/example5_fst.Rmd</code></a></small>
      <div class="hidden name"><code>example5_fst.Rmd</code></div>

    </div>

    
    
<p>The <a href="https://github.com/fstpackage/fst">fst</a> package for R provides a fast, easy and flexible way to serialize data frames. It has very amazing features, such as fast read and write of R data frames, super file compression and parse data frames without reading it. Considering all these features, now <a href="https://github.com/hope-data-science/tidyfst">tidyfst</a> could provide a new workflow to manipulate data more efficiently. The core idea is: We never need the whole data all at once, we only need the things we want and aggregate them to get the summary to provide target information.</p>
<p><em>tidyfst</em> have provided the following functions to facilitate the workflow:</p>
<ul>
<li>parse_fst: Get information of the data.frame without reading it</li>
<li>slice_fst: Select the target rows by number</li>
<li>select_fst: Select the target columns for the task</li>
<li>filter_fst: Conditional selection of rows</li>
<li>import_fst: Read a fst file like <code><a href="http://www.fstpackage.org/reference/write_fst.html">fst::read_fst</a></code> but always return a data.table</li>
<li>export_fst: Write a fst file like <code><a href="http://www.fstpackage.org/reference/write_fst.html">fst::write_fst</a></code> but always use largest compress factor (which yields smallest file)</li>
</ul>
<p>In such a workflow, you never need to read the whole data.frame into your RAM, you just select the target data, process them instantly and get the results all at once. You do not have to read the data to know the structure of data.frame, because we have <code>parse_fst</code>(a wrapper for <code>fst</code> in <em>fst</em> package). Now let’s give it a try.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hope-data-science/tidyfst">tidyfst</a></span><span class="op">)</span>

<span class="co"># Generate some random data frame with 10 million rows and various column types</span>
<span class="va">nr_of_rows</span> <span class="op">&lt;-</span> <span class="fl">1e7</span>

<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
    Logical <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">NA</span><span class="op">)</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.85</span>, <span class="fl">0.1</span>, <span class="fl">0.05</span><span class="op">)</span>, <span class="va">nr_of_rows</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
    Integer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">1L</span><span class="op">:</span><span class="fl">100L</span>, <span class="va">nr_of_rows</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
    Real <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10000</span>, <span class="fl">20</span><span class="op">)</span> <span class="op">/</span> <span class="fl">100</span>, <span class="va">nr_of_rows</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
    Factor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/labels.html">labels</a></span><span class="op">(</span><span class="va">UScitiesD</span><span class="op">)</span>, <span class="va">nr_of_rows</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span>

<span class="co"># write the fst file, make sure you do not have the file with same name in the directory</span>
<span class="fu"><a href="../reference/export_fst.html">export_fst</a></span><span class="op">(</span><span class="va">df</span>,<span class="st">"fst_test.fst"</span><span class="op">)</span>

<span class="co"># remove all variables in the environment</span>
<span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Now, we want to know the information in the data frame.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/fst.html">parse_fst</a></span><span class="op">(</span><span class="st">"fst_test.fst"</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">ft</span>
<span class="va">ft</span></code></pre></div>
<p>If we want to get the information in the <code>Factor</code> column, use:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ft</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/fst.html">select_fst</a></span><span class="op">(</span><span class="va">Factor</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/count_dt.html">count_dt</a></span><span class="op">(</span><span class="va">Factor</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">factor_info</span>

<span class="va">factor_info</span></code></pre></div>
<p>If we want to calculate the mean of <code>Integer</code> by the group of <code>Factor</code>, use:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ft</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/fst.html">select_fst</a></span><span class="op">(</span><span class="va">Integer</span>,<span class="va">Factor</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/summarise_dt.html">summarise_dt</a></span><span class="op">(</span>avg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Integer</span><span class="op">)</span>,by <span class="op">=</span> <span class="va">Factor</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">avg_info</span>

<span class="va">avg_info</span></code></pre></div>
<p>In this workflow, we only select/filter/slice the data we need, and get the results directly from the pipeline. Therefore, we read the minimum needed data into RAM and release it and save only the results we want. This workflow could save memory for many exploratory big data analysis. Last, let’s delete the output file:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># delete the output file</span>
<span class="fu"><a href="https://rdrr.io/r/base/unlink.html">unlink</a></span><span class="op">(</span><span class="st">"fst_test.fst"</span><span class="op">)</span></code></pre></div>
<p>After (&gt;=) version 0.9.3, tidyfst has also added a function <code><a href="../reference/as_fst.html">as_fst()</a></code>, which can turn any data.frame into a fst table and saved the data in the temporary file. This means that we might never have to save the object in the RAM ever (as long as it is a data.frame)! A small example:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">iris</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/as_fst.html">as_fst</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">iris_fst</span>
<span class="va">mtcars</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/as_fst.html">as_fst</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">mtcars_fst</span>

<span class="va">iris_fst</span>
<span class="va">mtcars_fst</span></code></pre></div>
<p>So when you have generated a pretty large data.frame and do not want it to consume the cache in your computer, just save it and read it when needed using <code>as_fst</code>.</p>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Tian-Yuan Huang.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
